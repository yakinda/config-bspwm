const ex$4=chrome||browser;var ContextMenus={create:create$1,onClick:onClick$1};function onClick$1(e,a){ex$4.tabs.sendMessage(a.id,e)}function create$1(){ex$4.contextMenus.create({id:"ddict:translate",title:"Ddict: Translate",contexts:["selection"]})}const ex$3=chrome||browser,wait=a=>new Promise(e=>setTimeout(e,a));var Helper$1={wait:wait,closeTab:closeTab,openTab:openTab,getURL:getURL,sendMsg:sendMsg,onMsg:onMsg,isRTL:isRTL,blobToBase64:blobToBase64,detectLanguage:detectLanguage};function closeTab(){ex$3.tabs.getCurrent(function(e){ex$3.tabs.remove(e.id,function(){})})}function openTab(e){ex$3.tabs.create({url:e})}function getURL(e){return ex$3.runtime.getURL(e)}function sendMsg(e,a){ex$3.runtime.sendMessage(e,a)}function onMsg(e){ex$3.runtime.onMessage.addListener(e)}function isRTL(e){return-1<["ar","fa","iw","yi","ur","pa"].indexOf(e)}function blobToBase64(n){return new Promise((e,a)=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(n)})}function detectLanguage(){return navigator?navigator.languages?reviseLocale(navigator.languages[0]):reviseLocale(navigator.language):null}function reviseLocale(e){return e.split("-")[0]}const ex$2=chrome||browser;var Storage={get:get,set:set,remove:remove};const MAX_QUOTA=8e3;async function set(e,a){if(!(JSON.stringify(a).length>MAX_QUOTA))return ex$2.storage.sync.set({[e]:a})}async function get(e){var a=await ex$2.storage.sync.get(e)||{};return e?a[e]:a}async function remove(e){return ex$2.storage.sync.remove(e)}const ex$1=chrome||browser;var Notifications={create:create,onClick:onClick};function onClick(e){Helper$1.openTab("https://ddict.me/#update")}async function create(){ex$1.notifications.create({title:"Ddict New Update",message:"Check what's new",type:"basic",iconUrl:Helper$1.getURL("/logo/icon.png")})}var Helper={makeURL:makeURL,qs:qs};function makeURL(e="",a={}){return e+"?"+qs(a)}function qs(e={}){const a={},t={};let n="";for(const s in e){var i=e[s];Array.isArray(i)?t[s]=i:a[s]=i}n=new URLSearchParams(a).toString();for(const r in t){n+="&";const o=[];for(const l of e[r])o.push(new URLSearchParams({[r]:l}).toString());n+=o.join("&")}return n}var google={getLanguages:getLanguages$2,translate:translate$2,tts:tts$2};const DEFAULT_LANG="en",DEFAULT_ENCODING="UTF-8",USER_AGENT="GoogleTranslate",MAX_LENGTH$1=5e3,MAX_TTS_LENGTH=200;function getLanguages$2(e="en"){e={hl:e,client:"it",oe:DEFAULT_ENCODING,ie:DEFAULT_ENCODING};return{url:Helper.makeURL("https://translate.google.com/translate_a/l",e),method:"GET",headers:{"User-Agent":USER_AGENT}}}function translate$2(e=DEFAULT_LANG,a,t,n,i=!1){if(a.length>MAX_LENGTH$1)throw new Error("Maximum text length exceeded: "+MAX_LENGTH$1);const s={q:a,sl:t,tl:n,hl:e,client:"it",dt:["t","rmt","bd","rms","qca","ss","md","ld","ex","rw"],otf:"2",dj:"1",ie:DEFAULT_ENCODING,oe:DEFAULT_ENCODING};return i&&(s.dt="t"),{url:Helper.makeURL("https://translate.google.com/translate_a/single",s),method:"GET",headers:{"User-Agent":USER_AGENT}}}function tts$2(e=DEFAULT_LANG,a,t="input",n){t={q:a=a.substring(0,MAX_TTS_LENGTH),tl:n,hl:e,client:"it",total:"1",idx:"0",textlen:a.length,prev:t="input"!==t&&"target"!==t?"input":t,ie:DEFAULT_ENCODING};return{url:Helper.makeURL("https://translate.google.com/translate_tts",t),method:"GET",headers:{"User-Agent":USER_AGENT,Connection:"keep-alive"}}}var Translate={google:google},Default={lang:"en",settings:{src:"auto",target:"vi",icon:!0,dbclick:!0,shift:!0,tts:!0},languages:{sl:{auto:"Detect language",af:"Afrikaans",sq:"Albanian",am:"Amharic",ar:"Arabic",hy:"Armenian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",bg:"Bulgarian",ca:"Catalan",ceb:"Cebuano",ny:"Chichewa","zh-CN":"Chinese",co:"Corsican",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch",en:"English",eo:"Esperanto",et:"Estonian",tl:"Filipino",fi:"Finnish",fr:"French",fy:"Frisian",gl:"Galician",ka:"Georgian",de:"German",el:"Greek",gu:"Gujarati",ht:"Haitian Creole",ha:"Hausa",haw:"Hawaiian",iw:"Hebrew",hi:"Hindi",hmn:"Hmong",hu:"Hungarian",is:"Icelandic",ig:"Igbo",id:"Indonesian",ga:"Irish",it:"Italian",ja:"Japanese",jw:"Javanese",kn:"Kannada",kk:"Kazakh",km:"Khmer",rw:"Kinyarwanda",ko:"Korean",ku:"Kurdish (Kurmanji)",ky:"Kyrgyz",lo:"Lao",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"Macedonian",mg:"Malagasy",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mn:"Mongolian",my:"Myanmar (Burmese)",ne:"Nepali",no:"Norwegian",or:"Odia (Oriya)",ps:"Pashto",fa:"Persian",pl:"Polish",pt:"Portuguese",pa:"Punjabi",ro:"Romanian",ru:"Russian",sm:"Samoan",gd:"Scots Gaelic",sr:"Serbian",st:"Sesotho",sn:"Shona",sd:"Sindhi",si:"Sinhala",sk:"Slovak",sl:"Slovenian",so:"Somali",es:"Spanish",su:"Sundanese",sw:"Swahili",sv:"Swedish",tg:"Tajik",ta:"Tamil",tt:"Tatar",te:"Telugu",th:"Thai",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",ur:"Urdu",ug:"Uyghur",uz:"Uzbek",vi:"Vietnamese",cy:"Welsh",xh:"Xhosa",yi:"Yiddish",yo:"Yoruba",zu:"Zulu"},tl:{af:"Afrikaans",sq:"Albanian",am:"Amharic",ar:"Arabic",hy:"Armenian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",bg:"Bulgarian",ca:"Catalan",ceb:"Cebuano",ny:"Chichewa","zh-CN":"Chinese (Simplified)","zh-TW":"Chinese (Traditional)",co:"Corsican",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch",en:"English",eo:"Esperanto",et:"Estonian",tl:"Filipino",fi:"Finnish",fr:"French",fy:"Frisian",gl:"Galician",ka:"Georgian",de:"German",el:"Greek",gu:"Gujarati",ht:"Haitian Creole",ha:"Hausa",haw:"Hawaiian",iw:"Hebrew",hi:"Hindi",hmn:"Hmong",hu:"Hungarian",is:"Icelandic",ig:"Igbo",id:"Indonesian",ga:"Irish",it:"Italian",ja:"Japanese",jw:"Javanese",kn:"Kannada",kk:"Kazakh",km:"Khmer",rw:"Kinyarwanda",ko:"Korean",ku:"Kurdish (Kurmanji)",ky:"Kyrgyz",lo:"Lao",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"Macedonian",mg:"Malagasy",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mn:"Mongolian",my:"Myanmar (Burmese)",ne:"Nepali",no:"Norwegian",or:"Odia (Oriya)",ps:"Pashto",fa:"Persian",pl:"Polish",pt:"Portuguese",pa:"Punjabi",ro:"Romanian",ru:"Russian",sm:"Samoan",gd:"Scots Gaelic",sr:"Serbian",st:"Sesotho",sn:"Shona",sd:"Sindhi",si:"Sinhala",sk:"Slovak",sl:"Slovenian",so:"Somali",es:"Spanish",su:"Sundanese",sw:"Swahili",sv:"Swedish",tg:"Tajik",ta:"Tamil",tt:"Tatar",te:"Telugu",th:"Thai",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",ur:"Urdu",ug:"Uyghur",uz:"Uzbek",vi:"Vietnamese",cy:"Welsh",xh:"Xhosa",yi:"Yiddish",yo:"Yoruba",zu:"Zulu"},al:{}}};const Google=Translate.google,MAX_LENGTH=5e3;var Google$1={getLanguages:getLanguages$1,translate:translate$1,tts:tts$1,ttsBlob:ttsBlob};async function getLanguages$1(e){try{var a=Google.getLanguages(e);const t=await fetch(a.url,{method:a.method,headers:a.headers});return await t.json()}catch(e){return Default.languages}}async function translate$1(e="en",a,t,n){if(a.length>MAX_LENGTH)return alert("Maximum text length exceeded: "+MAX_LENGTH),{};t=Google.translate(e,a,t,n);const i=await fetch(t.url,{method:t.method,headers:t.headers}),s=await i.json();return s.text=a,s.target=n,s}async function tts$1(e="en",a,t){t=Google.tts(e,a,"input",t);const n=await fetch(t.url,{method:t.method,headers:t.headers});t=await n.blob();return URL.createObjectURL(t)}async function ttsBlob(e="en",a,t){t=Google.tts(e,a,"input",t);const n=await fetch(t.url,{method:t.method,headers:t.headers});return await n.blob()}chrome||browser;var Messages={on:on};function on(e,a,t){switch(e.channel){case"translate":translate(e.data).then(e=>{t(e)});break;case"tts":tts(e.data.text,e.data.src).then(e=>{t(e)});break;default:t(null)}return!0}async function translate(e){var a=await Storage.get("lang"),t=await Storage.get("settings")||Default.settings;try{var n=await Google$1.translate(a,e,t.src,t.target);return await Storage.set("last_word",n),n}catch(e){return null}}async function tts(e,a){try{var t=await Google$1.ttsBlob(null,e,a);return await Helper$1.blobToBase64(t)}catch(e){return null}}const ex=chrome||browser;async function getLanguages(){var e=await Storage.get("lang"),e=await Google$1.getLanguages(e);await Storage.set("languages",e)}ex.runtime.onMessage.addListener(Messages.on),ex.notifications.onClicked.addListener(Notifications.onClick),ex.contextMenus.onClicked.addListener(ContextMenus.onClick),ex.runtime.onInstalled.addListener(e=>{"update"===e.reason&&Notifications.create(),"install"===e.reason&&Helper$1.openTab("https://ddict.me/#update"),Storage.get("lang").then(e=>{e||Helper$1.openTab(Helper$1.getURL("/options.html"))}),ContextMenus.create()}),ex.runtime.onStartup.addListener(()=>{ContextMenus.create(),getLanguages().then()});
